<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
  <script src="/js/tailwindConfig.js"></script>
  <script src="/js/dashboard.js"></script>
  <style>
    .group {
      display: flex;
      line-height: 28px;
      align-items: center;
      position: relative;
      max-width: 990px;
    }
    .input {
      width: 100%;
      height: 40px;
      line-height: 28px;
      padding: 0 1rem;
      padding-left: 2.5rem;
      border: 2px solid transparent;
      border-radius: 8px;
      outline: none;
      background-color: #ffff;
      color: #0d0c22;
      transition: .2s ease;
    }
    .input::placeholder {
      color: #9e9ea7;
    }
    .input:focus, input:hover {
      outline: none;
      border-color: rgba(186, 180, 214, 0.4);
      background-color: #fff;
      box-shadow: 0 0 0 1px rgba(83, 49, 128, 0.1);
    }
    .icon {
      position: absolute;
      left: 1rem;
      fill: #9e9ea7;
      width: 1rem;
      height: 1rem;
    }
    /* Filter Button Styling */
    .filterbtn {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0 10px;
    }
    .filterbtn img {
      width: 1.2em;
      height: 1.2em;
      color: #6b7280; /* Slightly muted gray */
    }
    .filterbtn:hover img {
      filter: brightness(0.8); /* Darker effect on hover */
    }
    .dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      background-color: white;
      border: 1px solid #e5e7eb;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border-radius: 5px;
      overflow: hidden;
      z-index: 10;
      padding: 5px;
    }
    .dropdown-menu.active {
      display: block;
    }
    .dropdown-item {
      padding: 0.25rem 1.5rem;
      cursor: pointer;
      color: #374151;
      transition: background-color 0.2s ease;
      font-size: medium;
      display: 100%;
    }
    #dd1 {
      font-weight: 500;
      color: rgb(228, 17, 17);
    }
    #dd2 {
      font-weight: 500;
      color: rgb(15, 102, 69);
    }
    #dd3 {
      font-weight: 500;
      color: rgb(10, 10, 66);
    }
    .dropdown-item:hover {
      background-color: #f3f4f6;
    }
    .overflow-x-auto {
      padding-top: 60px;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 transition-all duration-300">
  <!-- Sidebar -->
  <aside class="fixed top-0 left-0 h-screen w-56 bg-gradient-to-b from-primary to-secondary shadow-md z-50">
    <div class="flex flex-col justify-between h-full">
      <div class="p-6">
        <h1 class="text-2xl font-bold text-white">Admin Dashboard</h1>
      </div>
      <nav class="flex-1 px-4">
        <ul class="space-y-3">
          <li>
            <a href="#" class="flex items-center space-x-3 p-3 rounded-lg text-white hover:bg-white/20 transition" onclick="showSection('dashboard')">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l9-9 9 9m-3 7v-4H6v4" />
              </svg>
              <span>Dashboard</span>
            </a>
          </li>
          <li>
            <a href="#" class="flex items-center space-x-3 p-3 rounded-lg text-white hover:bg-white/20 transition" onclick="showSection('centres')">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
              </svg>
              <span>Akshaya Centres</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </aside>
  <!-- Top Navbar -->
  <nav class="fixed top-0 left-56 right-0 bg-base-100 shadow-md py-2.5 px-6 flex justify-between items-center z-40">
    <div class="flex items-center space-x-4">
      <h2 class="text-xl font-semibold text-gray-700">
        Welcome back, <span class="text-primary"><%=user.pName%></span> ðŸ‘‹
      </h2>
    </div>
    <div class="flex items-center space-x-4">
      <div class="dropdown dropdown-end">
        <label tabindex="0" class="btn btn-ghost btn-circle avatar">
          <div class="w-10 h-10 rounded-full flex items-center justify-center text-black">
            <img src="/uploads/images/profile2.svg" alt="User Avatar" class="w-full h-full object-cover" />
          </div>
        </label>
        <div tabindex="0" class="mt-3 p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52">
          <div>
            <ul>
              <li>
                <p class="hover:text-[#6161f9] active:bg-white" onclick="redirect('profile')">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                  </svg>
                  User Profile
                </p>
              </li>
              <li>
                <p class="hover:text-[#6161f9] active:bg-white" onclick="redirect('change-pass')">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z" />
                  </svg>
                  Change Password
                </p>
              </li>
            </ul>
            <div class="border-t-[1.5px] border-[#dfdfe1]"></div>
            <ul>
              <li>
                <p class="hover:text-[#f04545] active:bg-white" onclick="redirect('logout')">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3H15" />
                  </svg>
                  Logout
                </p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <!-- Main Content -->
  <div class="flex ml-56 pt-20 bg-gray-100 min-h-screen">
    <main class="flex-1 p-6">
      <!-- Dashboard Overview Section -->
      <section id="dashboard-section">
        <!-- Header -->
        <div class="flex justify-between items-center bg-gray-200 shadow p-4 rounded-md mb-6">
          <h2 class="text-xl font-semibold">Dashboard Overview</h2>
          <span class="text-gray-700 font-medium">Admin</span>
        </div>
        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
          <div class="bg-white p-4 rounded shadow">
            <p class="text-sm text-gray-500">Total Centres</p>
            <p class="text-2xl font-bold text-gray-800"><%= counts.total %></p>
          </div>
          <div class="bg-white p-4 rounded shadow">
            <p class="text-sm text-gray-500">Approved Centres</p>
            <p class="text-2xl font-bold text-green-600"><%= counts.approved %></p>
          </div>
          <div class="bg-white p-4 rounded shadow">
            <p class="text-sm text-gray-500">Pending Approval</p>
            <p class="text-2xl font-bold text-yellow-600"><%= counts.pending %></p>
          </div>
          <div class="bg-white p-4 rounded shadow">
            <p class="text-sm text-gray-500">Rejected Centres</p>
            <p class="text-2xl font-bold text-red-600"><%= counts.rejected %></p>
          </div>
        </div>
      </section>
      <!-- Centres List Section -->
      <section id="centres-section" class="hidden">
        <h3 class="text-lg font-semibold mb-4">Akshaya Centres List</h3>
        <div class="group">
          <svg class="icon" aria-hidden="true" viewBox="0 0 24 24">
            <g>
              <path d="M21.53 20.47l-3.66-3.66C19.195 15.24 20 13.214 20 11c0-4.97-4.03-9-9-9s-9 4.03-9 9 4.03 9 9 9c2.215 0 4.24-.804 5.808-2.13l3.66 3.66c.147.146.34.22.53.22s.385-.073.53-.22c.295-.293.295-.767.002-1.06zM3.5 11c0-4.135 3.365-7.5 7.5-7.5s7.5 3.365 7.5 7.5-3.365 7.5-7.5 7.5-7.5-3.365-7.5-7.5z"></path>
            </g>
          </svg>
          <input placeholder="Search" type="search" class="input">
          <button class="filterbtn" id="dropdownButton">
            <img src="../uploads/images/filter.svg" alt="" class="w-6 h-6 rounded-full">
            <div id="dropdownMenu" class="dropdown-menu">
              <div class="dropdown-item" id="dd1" onclick="filterTable('pending')">Pending</div>
              <div class="dropdown-item" id="dd2" onclick="filterTable('approved')">Approved</div>
              <div class="dropdown-item" id="dd3" onclick="filterTable('rejected')">Rejected</div>
            </div>
          </button>
        </div>
        <!-- Centres Table -->
        <div class="overflow-x-auto">
          <table class="w-full border-collapse border border-gray-200">
            <thead>
              <tr class="bg-gray-100">
                <th class="border border-gray-300 p-2">Centre Name</th>
                <th class="border border-gray-300 p-2">Owner Name</th>
                <th class="border border-gray-300 p-2">Contact</th>
                <th class="border border-gray-300 p-2">Status</th>
                <th class="border border-gray-300 p-2">Actions</th>
              </tr>
            </thead>
            <tbody id="centres-table-body">
              <% if (centres.length === 0) { %>
                <tr>
                  <td colspan="5" class="border border-gray-300 p-2 text-center">No centres available.</td>
                </tr>
              <% } else { %>
                <% centres.forEach(function(centre) { %>
                  <tr class="centre-row" data-status="<%= centre.status %>">
                    <td class="border border-gray-300 p-2 text-center"><%= centre.centreName %></td>
                    <td class="border border-gray-300 p-2 text-center"><%= centre.ownerName %></td>
                    <td class="border border-gray-300 p-2 text-center"><%= centre.contact %></td>
                    <td class="border border-gray-300 p-2 text-center capitalize"><%= centre.status %></td>
                    <td class="border border-gray-300 p-2 text-center">
                      <% if (centre.status === 'pending') { %>
                        <a href="/approve-centre/<%= centre._id %>" class="text-green-500 hover:text-green-700">
                          <svg class="w-5 h-5 inline" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
                          </svg>
                        </a>
                        <a href="/reject-centre/<%= centre._id %>" class="text-red-500 hover:text-red-700 ml-4">
                          <svg class="w-5 h-5 inline" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                          </svg>
                        </a>
                      <% } else { %>
                        <span class="text-gray-500">No Actions</span>
                      <% } %>
                    </td>
                  </tr>
                <% }); %>
              <% } %>
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>
  <script>
    // Switch between Dashboard Overview and Centres List sections
    function showSection(section) {
      if (section === 'dashboard') {
        document.getElementById('dashboard-section').classList.remove('hidden');
        document.getElementById('centres-section').classList.add('hidden');
      } else if (section === 'centres') {
        document.getElementById('dashboard-section').classList.add('hidden');
        document.getElementById('centres-section').classList.remove('hidden');
      }
    }
    // Filter centres table based on status
    function filterTable(status) {
      const rows = document.querySelectorAll('.centre-row');
      rows.forEach(row => {
        if (status === 'all') {
          row.style.display = '';
        } else {
          if (row.getAttribute('data-status') === status) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        }
      });
    }
    // JavaScript to toggle the dropdown menu
    const dropdownButton = document.getElementById('dropdownButton');
    const dropdownMenu = document.getElementById('dropdownMenu');
    // Toggle active class on dropdown menu
    dropdownButton.addEventListener('click', () => {
      dropdownMenu.classList.toggle('active');
    });
    // Close dropdown when clicking outside
    document.addEventListener('click', (event) => {
      if (!dropdownButton.contains(event.target) && !dropdownMenu.contains(event.target)) {
        dropdownMenu.classList.remove('active');
      }
    });
    // Search functionality for Centre Name/Number
    const searchInput = document.querySelector('.input'); // Select the search input field
    const tableRows = document.querySelectorAll('.centre-row'); // Select all rows in the table
    searchInput.addEventListener('input', () => {
      const searchTerm = searchInput.value.toLowerCase().trim(); // Get the search term and normalize it
      tableRows.forEach(row => {
        const centreNameCell = row.querySelector('td:first-child'); // First column contains Centre Name/Number
        if (centreNameCell) {
          const centreName = centreNameCell.textContent.toLowerCase(); // Normalize the Centre Name/Number
          if (centreName.includes(searchTerm)) {
            row.style.display = ''; // Show matching rows
          } else {
            row.style.display = 'none'; // Hide non-matching rows
          }
        }
      });
    });
    // Example logout function (adjust as needed)
    function logout() {
      // For example, clear session data or call a logout API endpoint before redirecting:
      window.location.href = '/logout';
    }
  </script>
</body>
</html>